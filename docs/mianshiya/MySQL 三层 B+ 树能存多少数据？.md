# MySQL 三层 B+ 树能存多少数据？

**难度**：中等

**创建时间**：2025-10-05 08:43:52

## 答案
在 MySQL 的 InnoDB 存储引擎中，**三层 B+ 树通常能存储约 2000 万至 3000 万条数据**，具体数量受页大小、行数据大小、索引键大小等因素影响。以下为详细计算逻辑：

### **计算逻辑与关键参数**
1. **页大小（Page Size）**  
   InnoDB 默认页大小为 **16KB（16384 字节）**，可通过参数 `innodb_page_size` 调整。

2. **非叶子节点容量**  
   - 非叶子节点存储索引键（如 `BIGINT` 类型，占 8 字节）和指向子节点的指针（6 字节）。  
   - 每个非叶子节点可存储的索引项数：  
     \[
     \text{索引项数} = \frac{\text{页大小}}{\text{索引键大小} + \text{指针大小}} = \frac{16384}{8 + 6} \approx 1170
     \]  
     即每个非叶子节点可指向 **1170 个子节点**。

3. **叶子节点容量**  
   - 叶子节点存储完整数据行。假设每行数据大小为 **1KB**（实际可能更小或更大），则每个叶子节点可存储：  
     \[
     \frac{16\text{KB}}{1\text{KB}} = 16 \text{ 条数据}
     \]  
     若行数据更小（如 0.5KB），则可存储 32 条；若更大（如 4KB），则仅能存储 4 条。

4. **三层 B+ 树总容量**  
   - **根节点**：1 个，指向 1170 个中间节点。  
   - **中间层**：1170 个节点，每个指向 1170 个叶子节点，共 \(1170 \times 1170 = 1,368,900\) 个叶子节点。  
   - **叶子层**：每个叶子节点存储 16 条数据，总数据量为：  
     \[
     1170 \times 1170 \times 16 = 21,902,400 \text{ 条} \quad (\text{约 2000 万条})
     \]  
     若行数据为 0.8KB，则总数据量可达 **2700 万条**；若为 4KB，则降至 **500 万条**。

### **实际影响因素**
1. **主键大小**  
   使用更小的主键（如 `INT` 而非 `BIGINT`）可增加每页索引项数，从而提升容量。

2. **行数据大小**  
   行数据越小，叶子节点可存储的数据越多。例如，行数据从 1KB 减至 0.5KB 时，三层 B+ 树容量可从 2000 万条增至 4000 万条。

3. **填充因子**  
   InnoDB 页通常不会 100% 填满（默认填充因子约 15/16），实际存储量可能略低于理论值。

4. **变长字段**  
   `VARCHAR` 等变长字段会占用动态空间，影响每行实际大小。

### **优化建议**
1. **合理设计主键**  
   使用较小的数据类型（如 `INT`）作为主键，减少索引占用空间。

2. **控制行大小**  
   避免不必要的宽表，减少每行数据大小。

3. **分库分表**  
   当数据量接近 B+ 树容量极限时，考虑分库分表以分散压力。

4. **调整页大小**  
   在特定场景下（如存储大量大对象），可适当调整 `innodb_page_size`（如 32KB 或 64KB）。
