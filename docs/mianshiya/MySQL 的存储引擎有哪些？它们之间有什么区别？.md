# MySQL 的存储引擎有哪些？它们之间有什么区别？

**难度**：中等

**创建时间**：2025-10-04 08:42:36

## 答案
MySQL 支持多种存储引擎，每种引擎在数据存储方式、事务支持、锁机制、性能特点等方面存在差异。以下是 MySQL 常见的存储引擎及其核心区别，帮助开发者根据业务需求选择合适的引擎。

---

### **一、MySQL 常见存储引擎**
1. **InnoDB**（默认引擎）
2. **MyISAM**
3. **MEMORY**（原 HEAP）
4. **ARCHIVE**
5. **CSV**
6. **BLACKHOLE**
7. **MERGE**（已废弃）
8. **FEDERATED**

---

### **二、核心存储引擎对比**
#### **1. InnoDB**
**特点**：
- **事务支持**：支持 ACID 事务（原子性、一致性、隔离性、持久性）。
- **行级锁**：支持行级锁和表级锁，适合高并发写入。
- **外键约束**：支持外键，保证数据完整性。
- **崩溃恢复**：通过事务日志（redo log）和回滚日志（undo log）实现崩溃恢复。
- **MVCC（多版本并发控制）**：支持读已提交（Read Committed）和可重复读（Repeatable Read）隔离级别。
- **聚簇索引**：数据按主键聚簇存储，主键查询效率高。

**适用场景**：
- 需要事务支持的场景（如金融、电商）。
- 高并发读写（如订单系统、用户中心）。
- 需要外键约束的复杂业务。

**限制**：
- 相比 MyISAM，写入性能略低（因需维护事务和锁）。

---

#### **2. MyISAM**
**特点**：
- **非事务型**：不支持事务，无法回滚。
- **表级锁**：并发写入性能差（同一时间仅一个写入操作）。
- **全文索引**：支持全文检索（`FULLTEXT` 索引）。
- **压缩表**：支持表压缩（`myisampack`），节省存储空间。
- **高速读取**：计数器查询（如 `COUNT(*)`）极快（因存储了行数）。

**适用场景**：
- 读多写少的场景（如日志系统、数据分析）。
- 需要全文索引的文本搜索（如新闻网站）。
- 无需事务的简单查询（如配置表）。

**限制**：
- 崩溃后可能损坏表（需修复工具 `myisamchk`）。
- 不支持外键。

---

#### **3. MEMORY（HEAP）**
**特点**：
- **内存存储**：数据存储在内存中，速度极快。
- **表级锁**：并发写入性能有限。
- **临时表**：适合存储临时数据或缓存。
- **哈希索引**：默认使用哈希索引（支持等值查询），也可指定 B-Tree 索引。
- **非持久化**：服务器重启后数据丢失。

**适用场景**：
- 高速缓存（如会话数据、中间结果）。
- 临时表或快速查找表。

**限制**：
- 数据量受内存限制。
- 不支持 TEXT/BLOB 类型。

---

#### **4. ARCHIVE**
**特点**：
- **高压缩比**：适合存储大量历史数据（如日志）。
- **只支持插入和查询**：不支持更新和删除。
- **行级压缩**：按行压缩，节省存储空间。
- **低性能**：查询需解压数据，速度较慢。

**适用场景**：
- 归档数据（如审计日志、历史订单）。
- 长期存储且极少修改的数据。

**限制**：
- 不支持索引（除主键外）。
- 查询性能低。

---

#### **5. CSV**
**特点**：
- **CSV 格式存储**：数据以逗号分隔的文本文件存储。
- **无索引**：不支持索引，查询需全表扫描。
- **跨平台**：可直接用文本编辑器查看或导入其他系统。

**适用场景**：
- 数据交换（如导出数据给其他系统）。
- 简单数据存储（无需复杂查询）。

**限制**：
- 不支持事务、行级锁。
- 性能差。

---

#### **6. BLACKHOLE**
**特点**：
- **“黑洞”引擎**：接收数据但不存储，写入即丢弃。
- **复制中间件**：常用于主从复制中的中转节点（如过滤日志）。

**适用场景**：
- 测试或日志过滤。
- 复制架构中的特殊节点。

**限制**：
- 无实际数据存储。

---

### **三、关键区别总结**
| **特性**         | **InnoDB**       | **MyISAM**       | **MEMORY**       | **ARCHIVE**      | **CSV**          |
|------------------|------------------|------------------|------------------|------------------|------------------|
| **事务支持**     | 是               | 否               | 否               | 否               | 否               |
| **锁粒度**       | 行级/表级        | 表级             | 表级             | 行级（插入专用） | 无               |
| **外键支持**     | 是               | 否               | 否               | 否               | 否               |
| **索引类型**     | B-Tree           | B-Tree/FULLTEXT  | 哈希/B-Tree      | 主键             | 无               |
| **存储位置**     | 磁盘             | 磁盘             | 内存             | 磁盘             | 磁盘（CSV 文件） |
| **崩溃恢复**     | 是               | 否（需修复）     | 否（重启丢失）   | 否               | 否               |
| **适用场景**     | 高并发事务       | 读多写少         | 高速缓存         | 归档数据         | 数据交换         |

---

### **四、如何选择存储引擎？**
1. **需要事务和外键** → **InnoDB**（默认选择）。
2. **高速读取且无需事务** → **MyISAM**（如日志表）。
3. **临时数据或缓存** → **MEMORY**（如会话表）。
4. **历史数据归档** → **ARCHIVE**（如审计日志）。
5. **数据交换** → **CSV**（如导出报表）。
6. **复制中转** → **BLACKHOLE**（如日志过滤）。

---

### **五、示例：查看和修改存储引擎**
1. **查看当前表的引擎**：
   ```sql
   SHOW TABLE STATUS LIKE 'table_name';
   -- 或
   SELECT ENGINE FROM information_schema.TABLES 
   WHERE TABLE_SCHEMA = 'database_name' AND TABLE_NAME = 'table_name';
   ```

2. **创建表时指定引擎**：
   ```sql
   CREATE TABLE table_name (
     id INT PRIMARY KEY,
     name VARCHAR(100)
   ) ENGINE=InnoDB;
   ```

3. **修改已有表的引擎**：
   ```sql
   ALTER TABLE table_name ENGINE=InnoDB;
   ```

---

### **六、注意事项**
- **MySQL 8.0+ 默认引擎**：InnoDB（推荐始终使用）。
- **MyISAM 淘汰趋势**：新项目应避免使用，除非有特殊需求。
- **混合引擎风险**：同一数据库中混合使用不同引擎可能导致性能或功能问题（如外键失效）。
