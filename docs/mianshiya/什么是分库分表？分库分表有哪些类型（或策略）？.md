# 什么是分库分表？分库分表有哪些类型（或策略）？

**难度**：简单

**创建时间**：2025-10-06 15:36:01

## 答案
分库分表是一种数据库水平扩展技术，通过将数据分散到多个数据库或表中，解决单库单表在数据量增长时面临的性能瓶颈、存储容量限制和高并发压力问题。其核心目的是提升系统的可扩展性、稳定性和查询效率。

### **分库分表的类型（策略）**
根据拆分维度不同，分库分表可分为以下两类，每类包含多种具体策略：

#### **1. 水平拆分（Horizontal Splitting）**
将同一张表中的数据按行拆分到多个结构相同的表或库中，每个分片存储部分数据。  
**适用场景**：数据量极大（如单表超过千万级），但业务逻辑无需关联所有数据。  
**策略**：
- **Range分片**  
  按数据范围划分（如时间、ID区间）。  
  - **示例**：订单表按年份分片，2023年数据存`order_2023`，2024年存`order_2024`。  
  - **优点**：范围查询高效（如查询某时间段订单）。  
  - **缺点**：数据分布可能不均（如近期数据集中）。

- **Hash分片**  
  通过哈希函数计算数据分布的库/表。  
  - **示例**：用户ID通过哈希取模后存入`user_0`、`user_1`等表。  
  - **优点**：数据分布均匀，负载均衡。  
  - **缺点**：跨分片查询困难（如按用户昵称查询需遍历所有分片）。

- **List分片**  
  按离散值列表划分（如地区、业务类型）。  
  - **示例**：用户表按省份分片，北京用户存`user_beijing`，上海用户存`user_shanghai`。  
  - **优点**：按固定维度查询高效。  
  - **缺点**：新增维度需修改分片规则。

#### **2. 垂直拆分（Vertical Splitting）**
按列拆分，将一张表的字段分散到多个结构不同的表或库中。  
**适用场景**：表字段过多，或不同字段访问频率差异大（如“热字段”与“冷字段”分离）。  
**策略**：
- **垂直分表**  
  将大表按字段拆分为多个小表，通常按访问频率或业务相关性划分。  
  - **示例**：用户表拆分为`user_base`（ID、姓名、手机号）和`user_detail`（地址、备注）。  
  - **优点**：减少单表宽度，提升单表查询效率。  
  - **缺点**：跨表JOIN操作增加复杂度。

- **垂直分库**  
  按业务模块拆分到不同数据库。  
  - **示例**：电商系统将用户库、订单库、商品库分离。  
  - **优点**：隔离不同业务的数据和流量，避免相互影响。  
  - **缺点**：跨库事务处理复杂（需分布式事务方案）。

### **分库分表的核心挑战**
1. **跨分片查询**：需通过应用层聚合或使用分布式查询引擎（如MyCat、ShardingSphere）。  
2. **分布式事务**：需采用XA、TCC、SAGA等方案保证一致性。  
3. **全局ID生成**：避免自增ID冲突，常用雪花算法（Snowflake）、UUID等。  
4. **扩容难度**：水平拆分后扩容需数据迁移和重新分片（如Hash分片的取模值变化）。

### **典型工具与框架**
- **ShardingSphere**：支持多种分片策略，提供SQL路由、分布式事务等功能。  
- **MyCat**：代理层分库分表中间件，兼容MySQL协议。  
- **Vitess**：Google开源的MySQL集群管理工具，适用于大规模场景。

### **总结**
- **水平拆分**解决数据量问题，**垂直拆分**解决表宽度和业务隔离问题。  
- 选择策略时需权衡查询效率、数据分布均匀性、扩展性及维护成本。  
- 实际应用中常结合多种策略（如垂直分库+水平分表），并依赖中间件简化管理。
