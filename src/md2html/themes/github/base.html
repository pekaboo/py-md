<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ metadata.title or site.title or '文档' }}</title>
  {% if metadata.description or site.description %}
  <meta name="description" content="{{ metadata.description or site.description }}" />
  {% endif %}
  {{ style_block | safe }}
  {{ syntax_block | safe }}
</head>
<body class="md2html-body">
  {% set current_segments = site.get('current_segments', []) | list %}
  {% set navigation = site.get('navigation', []) %}
  {% set navigation_label = site.get('navigation_label', '文档') %}
  {% set outline_label = site.get('outline_label', '大纲') %}
  {% set base_url = (site.get('base_url') or '').rstrip('/') %}
  {% macro nav_href(url) -%}
    {%- if base_url -%}{{ base_url }}/{{ url }}{%- else -%}/{{ url }}{%- endif -%}
  {%- endmacro %}
  {% macro render_nav(nodes, current_segments) -%}
    {%- for node in nodes %}
      {% set depth = node.segments | length %}
      {% set is_active = current_segments == node.segments %}
      {% set is_expanded = current_segments[:depth] == node.segments %}
  {% set node_key = node.url or (node.segments | join('/')) or (node.title | replace(' ', '-') | lower) %}
  {% set child_id = ('nav-' ~ node_key) | replace('/', '-') | replace('.', '-') %}
      <div class="md2html-nav__item{% if is_active %} md2html-nav__item--active{% endif %}{% if is_expanded %} md2html-nav__item--expanded{% endif %}"
        data-nav-node="{{ node_key }}">
        <div class="md2html-nav__entry{% if not node.children %} md2html-nav__entry--leaf{% endif %}">
          {% if node.children %}
          <button type="button"
            class="md2html-nav__toggle"
            data-nav-toggle="{{ node_key }}"
            data-expanded="{% if is_expanded %}true{% else %}false{% endif %}"
            {% if is_expanded %}data-initial-expanded="true"{% endif %}
              {% if is_expanded %}aria-expanded="true"{% else %}aria-expanded="false"{% endif %}
            aria-label="切换 {{ node.title }} 子目录">
            <span class="md2html-nav__toggle-icon" aria-hidden="true"></span>
          </button>
          {% endif %}
          {% if node.url %}
          <a class="md2html-nav__link" href="{{ nav_href(node.url) }}">{{ node.title }}</a>
          {% else %}
          <span class="md2html-nav__text">{{ node.title }}</span>
          {% endif %}
        </div>
        {% if node.children %}
  <div class="md2html-nav__list" id="{{ child_id }}">
          {{ render_nav(node.children, current_segments) }}
        </div>
        {% endif %}
      </div>
    {%- endfor %}
  {%- endmacro %}
  <div class="md2html-layout{% if not toc %} md2html-layout--no-outline{% endif %}">
    <aside class="md2html-sidebar" aria-label="{{ navigation_label }}">
      <div class="md2html-sidebar__brand">
        <span class="md2html-sidebar__brand-title">{{ site.title or metadata.title or '文档' }}</span>
        {% if site.description %}
        <span class="md2html-sidebar__brand-description">{{ site.description }}</span>
        {% endif %}
      </div>
      {% if navigation %}
      <nav class="md2html-sidebar__nav" aria-label="{{ navigation_label }}">
        <div class="md2html-sidebar__section-title">{{ navigation_label }}</div>
        <div class="md2html-nav">
          {{ render_nav(navigation, current_segments) }}
        </div>
      </nav>
      {% endif %}
    </aside>
    <main class="md2html-main">
      <header class="md2html-header">
        <div class="md2html-header__inner">
          <div class="md2html-header__text">
            <div class="md2html-header__title">{{ metadata.title or site.title or '文档' }}</div>
            {% if metadata.description or site.description %}
            <p class="md2html-header__description">{{ metadata.description or site.description }}</p>
            {% endif %}
          </div>
          <div class="md2html-header__actions" aria-label="界面控制">
            {% if navigation %}
            <button type="button" class="md2html-action-button md2html-action-button--mobile" data-action="open-drawer" data-target="navigation" title="打开{{ navigation_label }}" aria-label="打开{{ navigation_label }}">
              <span class="md2html-action-button__icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" focusable="false">
                  <path d="M4 6.5h16a1 1 0 1 0 0-2H4a1 1 0 0 0 0 2Zm16 5H4a1 1 0 0 0 0 2h16a1 1 0 1 0 0-2Zm0 7H4a1 1 0 0 0 0 2h16a1 1 0 1 0 0-2Z"/>
                </svg>
              </span>
            </button>
            {% endif %}
            {% if toc %}
            <button type="button" class="md2html-action-button md2html-action-button--mobile" data-action="open-drawer" data-target="outline" title="打开{{ outline_label }}" aria-label="打开{{ outline_label }}">
              <span class="md2html-action-button__icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" focusable="false">
                  <path d="M5 6a2 2 0 1 1 4 0 2 2 0 0 1-4 0Zm0 12a2 2 0 1 1 4 0 2 2 0 0 1-4 0ZM7 11a2 2 0 1 0-2 2 2 2 0 0 0 2-2Zm5-5.5a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2h-6a1 1 0 0 1-1-1Zm1 5a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2h-6a1 1 0 0 1-1-1Zm1 6a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2h-6a1 1 0 0 1-1-1Z"/>
                </svg>
              </span>
            </button>
            {% endif %}
            <button type="button" class="md2html-action-button" data-action="toggle-theme" data-state="light" aria-pressed="false" title="切换黑白模式">
              <span class="md2html-action-button__icon md2html-action-button__icon--sun" aria-hidden="true">
                <svg viewBox="0 0 24 24" focusable="false">
                  <path d="M12 4.5a1 1 0 0 1-1-1V2a1 1 0 1 1 2 0v1.5a1 1 0 0 1-1 1Zm0 17a1 1 0 0 1-1-1V19a1 1 0 1 1 2 0v1.5a1 1 0 0 1-1 1Zm7.5-7.5a1 1 0 0 1-1 1H17a1 1 0 1 1 0-2h1.5a1 1 0 0 1 1 1Zm-14 0a1 1 0 0 1-1 1H3a1 1 0 1 1 0-2h1.5a1 1 0 0 1 1 1Zm10.61-6.61a1 1 0 0 1 0-1.41l1.06-1.06a1 1 0 1 1 1.41 1.41L17.5 7.39a1 1 0 0 1-1.41 0Zm-9.22 9.22a1 1 0 0 1 0-1.41L6.94 11.64a1 1 0 0 1 1.41 1.41L7.39 14.7a1 1 0 0 1-1.41 0Zm9.22 0 1.06 1.06a1 1 0 0 1-1.41 1.41L14.7 17.5a1 1 0 0 1 1.41-1.41Zm-9.22-9.22L7.39 6.94A1 1 0 1 1 5.98 5.53L4.92 6.59A1 1 0 0 1 6.33 8ZM12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8Z"/>
                </svg>
              </span>
              <span class="md2html-action-button__icon md2html-action-button__icon--moon" aria-hidden="true">
                <svg viewBox="0 0 24 24" focusable="false">
                  <path d="M21 12.79a9 9 0 0 1-11.79 8.53 1 1 0 0 1-.21-1.8A7 7 0 0 0 13.48 4a1 1 0 0 1 .86-1.49A9 9 0 0 1 21 12.79Z"/>
                </svg>
              </span>
            </button>
            <button type="button" class="md2html-action-button" data-action="toggle-expand" data-state="collapsed" aria-pressed="false" title="展开或折叠隐藏内容">
              <span class="md2html-action-button__icon md2html-action-button__icon--expand" aria-hidden="true">
                <svg viewBox="0 0 24 24" focusable="false">
                  <path d="M6 9a1 1 0 0 1 .48-1.34l5-2a1 1 0 0 1 .9 0l5 2A1 1 0 0 1 18 9v6a1 1 0 0 1-.62.92l-5 2a1 1 0 0 1-.76 0l-5-2A1 1 0 0 1 6 15Zm2 .62v4.57L12 16l4-1.81V9.62L12 8Z"/>
                </svg>
              </span>
              <span class="md2html-action-button__icon md2html-action-button__icon--collapse" aria-hidden="true">
                <svg viewBox="0 0 24 24" focusable="false">
                  <path d="M6 9a1 1 0 0 1 .7-.95l5-1.67a1 1 0 0 1 .6 0l5 1.67A1 1 0 0 1 18 9v6a1 1 0 0 1-.7.95l-5 1.67a1 1 0 0 1-.6 0l-5-1.67A1 1 0 0 1 6 15Zm2 .62v4.08L12 16l4-1.3V9.62L12 8.38Z"/>
                </svg>
              </span>
            </button>
          </div>
        </div>
      </header>
      {% if navigation %}
      <div class="md2html-drawer" data-drawer="navigation" aria-hidden="true">
        <button type="button" class="md2html-drawer__backdrop" data-drawer-dismiss aria-label="关闭{{ navigation_label }}"></button>
        <aside class="md2html-drawer__panel" aria-label="{{ navigation_label }}">
          <div class="md2html-drawer__header">
            <span class="md2html-drawer__title">{{ navigation_label }}</span>
            <button type="button" class="md2html-drawer__close" data-drawer-dismiss aria-label="关闭{{ navigation_label }}">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="md2html-drawer__body">
            <nav class="md2html-drawer__section" aria-label="{{ navigation_label }}">
              <div class="md2html-nav">
                {{ render_nav(navigation, current_segments) }}
              </div>
            </nav>
          </div>
        </aside>
      </div>
      {% endif %}
      {% if toc %}
      <div class="md2html-drawer" data-drawer="outline" aria-hidden="true">
        <button type="button" class="md2html-drawer__backdrop" data-drawer-dismiss aria-label="关闭{{ outline_label }}"></button>
        <aside class="md2html-drawer__panel md2html-drawer__panel--right" aria-label="{{ outline_label }}">
          <div class="md2html-drawer__header">
            <span class="md2html-drawer__title">{{ outline_label }}</span>
            <button type="button" class="md2html-drawer__close" data-drawer-dismiss aria-label="关闭{{ outline_label }}">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="md2html-drawer__body">
            <div class="md2html-toc">
              <div class="md2html-toc__list">
                {%- for item in toc %}
                <div class="md2html-toc__item md2html-toc__item--level-{{ item.level }}">
                  <a href="#{{ item.slug }}">{{ item.title }}</a>
                </div>
                {%- endfor %}
              </div>
            </div>
          </div>
        </aside>
      </div>
      {% endif %}
      <article class="md2html-article markdown-body">
        {{ content | safe }}
      </article>
    </main>
    {% if toc %}
    <aside class="md2html-outline" aria-label="{{ outline_label }}">
      <div class="md2html-outline__section-title">{{ outline_label }}</div>
      <div class="md2html-toc">
        <div class="md2html-toc__list">
          {%- for item in toc %}
          <div class="md2html-toc__item md2html-toc__item--level-{{ item.level }}">
            <a href="#{{ item.slug }}">{{ item.title }}</a>
          </div>
          {%- endfor %}
        </div>
      </div>
    </aside>
    {% endif %}
  </div>
  <script>
    (function () {
      const root = document.documentElement;
      const themeKey = "md2html-theme";
      const expandKey = "md2html-expand-hidden";
      const navKey = "md2html-nav-expanded";
      const themeButton = document.querySelector('[data-action="toggle-theme"]');
      const expandButton = document.querySelector('[data-action="toggle-expand"]');
      const pageBody = document.body;
      const drawerButtons = document.querySelectorAll('[data-action="open-drawer"]');
      const drawerDismissButtons = document.querySelectorAll('[data-drawer-dismiss]');
      const drawerMap = new Map();
      for (const drawer of document.querySelectorAll('[data-drawer]')) {
        const name = drawer.dataset.drawer;
        if (name) {
          drawerMap.set(name, drawer);
        }
      }
      const navContainers = document.querySelectorAll('.md2html-nav');

      const prefersDark = globalThis.matchMedia && globalThis.matchMedia('(prefers-color-scheme: dark)').matches;

      function saveTheme(value) {
        try {
          localStorage.setItem(themeKey, value);
        } catch (err) {
          console.debug('Failed to persist theme preference', err);
        }
      }

      function getStoredTheme() {
        try {
          const value = localStorage.getItem(themeKey);
          return value === 'dark' || value === 'light' ? value : null;
        } catch (err) {
          console.debug('Failed to read theme preference', err);
          return null;
        }
      }

      function applyTheme(mode, persist = true) {
        if (mode === 'dark' || mode === 'light') {
          root.dataset.md2htmlTheme = mode;
          if (persist) {
            saveTheme(mode);
          }
        } else {
          delete root.dataset.md2htmlTheme;
          if (persist) {
            try {
              localStorage.removeItem(themeKey);
            } catch (err) {
              console.debug('Failed to clear theme preference', err);
            }
          }
        }
        updateThemeButton(mode || (prefersDark ? 'dark' : 'light'));
      }

      function updateThemeButton(mode) {
        if (!themeButton) return;
        const isDark = mode === 'dark';
        themeButton.setAttribute('aria-pressed', isDark ? 'true' : 'false');
        themeButton.dataset.state = isDark ? 'dark' : 'light';
      }

      function toggleTheme() {
        const current = root.dataset.md2htmlTheme || getStoredTheme() || (prefersDark ? 'dark' : 'light');
        const next = current === 'dark' ? 'light' : 'dark';
        applyTheme(next);
      }

      function saveExpandPreference(value) {
        try {
          localStorage.setItem(expandKey, value ? 'true' : 'false');
        } catch (err) {
          console.debug('Failed to persist expand preference', err);
        }
      }

      function getExpandPreference() {
        try {
          return localStorage.getItem(expandKey) === 'true';
        } catch (err) {
          console.debug('Failed to read expand preference', err);
          return false;
        }
      }

      function applyExpand(enabled, persist = true) {
        for (const details of document.querySelectorAll('.md2html-hide')) {
          if (!(details instanceof HTMLDetailsElement)) continue;
          if (enabled) {
            details.open = true;
            details.dataset.md2htmlForceOpen = 'true';
          } else if (details.dataset.md2htmlForceOpen === 'true') {
            details.open = false;
            delete details.dataset.md2htmlForceOpen;
          }
        }
        if (expandButton) {
          expandButton.setAttribute('aria-pressed', enabled ? 'true' : 'false');
          expandButton.dataset.state = enabled ? 'expanded' : 'collapsed';
        }
        if (persist) {
          saveExpandPreference(enabled);
        }
      }

      function toggleExpand() {
        const isExpanded = expandButton ? expandButton.dataset.state === 'expanded' : false;
        applyExpand(!isExpanded);
      }

      function loadExpandedNav() {
        try {
          const raw = localStorage.getItem(navKey);
          if (!raw) {
            return new Set();
          }
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) {
            return new Set(parsed.filter(Boolean));
          }
        } catch (err) {
          console.debug('Failed to read navigation state', err);
        }
        return new Set();
      }

      const expandedNavFolders = loadExpandedNav();

      function persistExpandedNav() {
        try {
          localStorage.setItem(navKey, JSON.stringify(Array.from(expandedNavFolders)));
        } catch (err) {
          console.debug('Failed to persist navigation state', err);
        }
      }

      function updateDrawerBodyState() {
        for (const drawer of drawerMap.values()) {
          if (drawer.classList.contains('md2html-drawer--open')) {
            if (pageBody) {
              pageBody.classList.add('md2html-body--drawer-open');
            }
            return;
          }
        }
        if (pageBody) {
          pageBody.classList.remove('md2html-body--drawer-open');
        }
      }

      function setDrawerState(name, open) {
        const drawer = drawerMap.get(name);
        if (!drawer) {
          return;
        }
        drawer.classList.toggle('md2html-drawer--open', open);
        drawer.setAttribute('aria-hidden', open ? 'false' : 'true');
        updateDrawerBodyState();
      }

      function closeAllDrawers() {
        for (const name of drawerMap.keys()) {
          setDrawerState(name, false);
        }
      }

      function applyNavState() {
        const items = document.querySelectorAll('[data-nav-node]');
        for (const item of items) {
          const key = item.dataset.navNode;
          if (!key) continue;
          const toggle = item.querySelector('[data-nav-toggle]');
          const seeded = toggle && toggle.dataset.initialExpanded === 'true';
          const hasActiveDescendant = item.classList.contains('md2html-nav__item--active') || Boolean(item.querySelector('.md2html-nav__item--active'));
          const shouldExpand = expandedNavFolders.has(key) || hasActiveDescendant || seeded;
          item.classList.toggle('md2html-nav__item--expanded', shouldExpand);
          if (toggle) {
            toggle.ariaExpanded = shouldExpand ? 'true' : 'false';
            toggle.dataset.expanded = shouldExpand ? 'true' : 'false';
            if (seeded) {
              toggle.dataset.initialExpanded = 'false';
            }
          }
        }
      }

      for (const container of navContainers) {
        container.addEventListener('click', function (event) {
          const target = event.target instanceof Element ? event.target : null;
          if (!target) {
            return;
          }
          const toggle = target.closest('[data-nav-toggle]');
          if (!toggle) {
            return;
          }
          event.preventDefault();
          event.stopPropagation();
          const item = toggle.closest('[data-nav-node]');
          const key = toggle.dataset.navToggle;
          if (!item || !key) {
            return;
          }
          const isExpanded = item.classList.contains('md2html-nav__item--expanded');
          const nextState = !isExpanded;
          item.classList.toggle('md2html-nav__item--expanded', nextState);
          toggle.ariaExpanded = nextState ? 'true' : 'false';
          toggle.dataset.expanded = nextState ? 'true' : 'false';
          if (nextState) {
            expandedNavFolders.add(key);
          } else {
            expandedNavFolders.delete(key);
          }
          persistExpandedNav();
          applyNavState();
        });
      }

      for (const button of drawerButtons) {
        button.addEventListener('click', function () {
          const targetName = button.dataset.target;
          if (!targetName) {
            return;
          }
          const drawer = drawerMap.get(targetName);
          const isOpen = drawer ? drawer.classList.contains('md2html-drawer--open') : false;
          if (isOpen) {
            setDrawerState(targetName, false);
          } else {
            closeAllDrawers();
            setDrawerState(targetName, true);
          }
        });
      }

      for (const dismiss of drawerDismissButtons) {
        dismiss.addEventListener('click', function () {
          const parentDrawer = dismiss.closest('[data-drawer]');
          if (!parentDrawer) {
            return;
          }
          const targetName = parentDrawer.dataset.drawer;
          if (!targetName) {
            return;
          }
          setDrawerState(targetName, false);
        });
      }

      for (const link of document.querySelectorAll('[data-drawer] .md2html-nav__link, [data-drawer] .md2html-toc a')) {
        link.addEventListener('click', function () {
          closeAllDrawers();
        });
      }

      document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
          for (const drawer of drawerMap.values()) {
            if (drawer.classList.contains('md2html-drawer--open')) {
              event.preventDefault();
              closeAllDrawers();
              break;
            }
          }
        }
      });

      if (themeButton) {
        themeButton.addEventListener('click', toggleTheme);
      }
      if (expandButton) {
        expandButton.addEventListener('click', toggleExpand);
      }

      const storedTheme = getStoredTheme();
      if (storedTheme) {
        applyTheme(storedTheme, false);
      } else {
        updateThemeButton(prefersDark ? 'dark' : 'light');
      }

      closeAllDrawers();
      applyExpand(getExpandPreference(), false);
      applyNavState();
    })();
  </script>
</body>
</html>
